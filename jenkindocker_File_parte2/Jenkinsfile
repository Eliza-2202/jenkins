pipeline {
    agent any

    stages {
        stage('Checkout SCM') {
            steps {
                checkout scm
            }
        }

        stage('Build Docker Image') {
            steps {
                dir('dockerKuberMini_File') {
                    sh 'docker build -t eliza22/suerte:tag -f Dockerfile .'
                }
            }
        }

        stage('Deploy to Kubernetes') {
            steps {
                dir('dockerKuberMini_File') {
                    script {

                        // Aplicar el deployment
                        
                        sh 'chmod -R 777 /home/datablitz/Desktop/jenkins/jenkindocker_File_parte2/certs'
                        
                        sh 'kubectl apply -f deployment.yml --validate=false'
                        
                        // Aplicar el servicio
                        sh 'kubectl apply -f service.yml --validate=false'
                    }
                }
            }
        }

        stage('Check Application') {
            steps {
                // Verificar los servicios
                sh 'kubectl get services'
            }
        }
    }
}

